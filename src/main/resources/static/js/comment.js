$(function(){$(".emotion").qqFace({id:"facebox",assign:"comment-textarea",path:"../images/arclist/"});$(".comment-content").each(function(){var C=this.innerText;$(this).html(replace_em(C))});$(".rely-comment-content").each(function(){var C=this.innerText;$(this).html(replace_em(C))});var B=$(".article-toolbar .article-toobar-goods .article-toobar-goodsNum").attr("id");var A=null;if(B!=null){getJSON(B,A);$(document).on("click","#page a",function(){var C=$(this).attr("pagenow");$(".commentlist li").remove();$(".totalCounts").remove();$("#page a").remove();if(C){getJSON(B,Number(C))}});$(document).on("click","#pn_btn",function(){var D=$("#pn_input").val();var C=$("#totalPageCount").text();if(D>C||D<=0){window.location.href="../404"}else{$(".commentlist li").remove();$(".totalCounts").remove();$("#page a").remove();getJSON(B,Number(D))}})}$("#comment-submit").click(function(){var C=$(this).parent().parent().children("#comment-textarea").val();if(C!==""){$.ajax({url:"../addComments",type:"POST",data:{apid:B,value:C,},dataType:"JSON",success:function(D){if(D.code=="200"){var E=D.result;$(".commentlist").append(appendComment(E));if($(".nothing").length>0){$(".nothing").remove()}$(".commentlist li").remove();$(".totalCounts").remove();$("#page a").remove();getJSON(B,Number(1));letDivCenter(".boxs","评论发表成功");setTimeout(function(){$(".boxs").hide()},1000)}else{letDivCenter(".boxs","评论发表失败");setTimeout(function(){$(".boxs").hide()},1000)}}})}else{letDivCenter(".boxs","请输入内容");setTimeout(function(){$(".boxs").hide()},1000)}});$(document).on("click",".comment-goods",function(){if($(this).children().hasClass("glyphicon-heart-empty")){var C=$(this).children().attr("cid");$.ajax({url:"../goods",type:"POST",data:{apid:B,cid:C,},dataType:"JSON",success:function(F){var D=F.result.flag;var E=F.result.praisenum;if(D=="true"){$("#ccid"+C).attr("class","glyphicon glyphicon-heart");$("#ccid"+C).html(E)}else{letDivCenter(".boxs","点赞失败了，请刷新一下重试");setTimeout(function(){$(".boxs").hide()},1000)}}})}else{letDivCenter(".boxs","你已经点赞了");setTimeout(function(){$(".boxs").hide()},1000)}});$(document).on("click",".comment-reply-link",function(){if($(this).parent().parent().parent().find("#rely-respond").length>0){$("#rely-respond").remove()}else{$("#rely-respond").remove();replyClick($(this),B)}})});function replace_em(A){A=A.replace(/\</g,"&lt;");A=A.replace(/\>/g,"&gt;");A=A.replace(/\[em_([0-9]*)\]/g,'<img src="../images/arclist/$1.gif" border="0" />');return A}function replace_em(A){A=A.replace(/\</g,"&lt;");A=A.replace(/\>/g,"&gt;");A=A.replace(/\[em_([0-9]*)\]/g,'<img src="../images/arclist/$1.gif" border="0" />');return A}function replyClick(A,B){A.parent().parent().parent().append("<div id='rely-respond'><div class='rely-comment'><div class='rely-comment-title'><img class='rely-avatar' src='../images/nobody.png' alt='' draggable='false'></div><div class='rely-comment-box'><textarea placeholder='要评论一下嘛 客官' name='rely-content' id='rely-comment-textarea' cols='100%' rows='3' tabindex='1'></textarea><input type='hidden' name='articleId' value=''><div class='rely-comment-ctrl'><span class='rely-emotion' style='display:none;'><img src='../images/qqFace.png' width='20' height='20' alt='' draggable='false'>表情</span><div class='rely-comment-prompt'><i class='fa fa-spin fa-circle-o-notch'></i><span class='rely-comment-prompt-text'></span></div><input type='hidden' value='1' class='articleId'><button type='submit' name='rely-comment-submit' id='rely-comment-submit'>发送</button></div></div></div>").find("#rely-comment-submit").click(function(){var C=$(this).parent().prev().prev().val();var E=$(this).parent().parent().parent().parent().parent().children("div:eq(0)").children("div:eq(0)").children(".comment-goods").children("i:eq(0)").attr("recid");var D=$(".disabled span").last().html();if(D==""||D=="undefined"){D=1}if(E=="null"){E=$(this).parent().parent().parent().parent().parent().children("div:eq(0)").children("div:eq(0)").children(".comment-goods").children("i:eq(0)").attr("cid")}if(C!==""){$.ajax({url:"../addReComments",type:"POST",data:{apid:B,value:C,cid:E,},dataType:"JSON",success:function(G){if(G.code=="200"){var H=G.result;var F=createReplyComment(H);$("#rely-respond").remove();A.parent().parent().parent().parent().append(F);letDivCenter(".boxs","评论发表成功");setTimeout(function(){$(".boxs").hide()},1000);$(".commentlist li").remove();$(".totalCounts").remove();$("#page a").remove();getJSON(B,Number(D))}else{letDivCenter(".boxs","评论发表失败");setTimeout(function(){$(".boxs").hide()},1000)}}})}else{letDivCenter(".boxs","请输入内容");setTimeout(function(){$(".boxs").hide()},1000)}})}function createReplyComment(A){var B="<ul class='comment-reply-body'><li class='comment-body-li'><div class='comment-body'><div class='comment-reply-main'><span class='comment-content'>"+replace_em(A.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+A.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+A.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+A.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+A.id+"' recid='"+A.cid+"' id='ccid"+A.id+"'>"+A.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div><img alt='' data-original='../images/nobody.png' class='comment-reply-headImg' src='../images/nobody.png'></div></li></ul>	";return B}function appendComment(B){var A="<li class='comment-body-li' id='cid"+B.id+"'><div class='comment-body'><img alt='' class='comment-headImg'  src='../images/nobody.png'><div class='comment-main'><span class='comment-content'>"+replace_em(B.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+B.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+B.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+B.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+B.id+"' recid='"+B.cid+"' id='ccid"+B.id+"'>"+B.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div>	</div></li>";return A}function getJSON(B,A){if(A==null){A=1}$.ajax({url:"../commentJson",type:"POST",data:{apid:B,pageNow:A},dataType:"JSON",success:function(F){var G=F.result.comments;if(G!=""){var C=F.result.recomments;var E=F.result.page;if(C!=""){for(i in G){if(G[i].flag=="false"){$(".commentlist").append("<li class='comment-body-li' id='cid"+G[i].comment.id+"'><div class='comment-body'><img alt='' class='comment-headImg'  src='../images/nobody.png'><div class='comment-main'><span class='comment-content'>"+replace_em(G[i].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+G[i].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+G[i].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+G[i].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+G[i].comment.id+"' recid='"+G[i].comment.cid+"' id='ccid"+G[i].comment.id+"'>"+G[i].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div>	</div></li>");for(k in C){if(C[k].comment.cid==G[i].comment.id){if(C[k].flag=="false"){$("#cid"+C[k].comment.cid).append("<ul class='comment-reply-body'><li class='comment-body-li'><div class='comment-body'><div class='comment-reply-main'><span class='comment-content'>"+replace_em(C[k].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+C[k].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+C[k].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+C[k].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+C[k].comment.id+"' recid='"+C[k].comment.cid+"' id='ccid"+C[k].comment.id+"'>"+C[k].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div><img alt='' data-original='../images/nobody.png' class='comment-reply-headImg' src='../images/nobody.png'></div></li></ul>	")}else{$("#cid"+C[k].comment.cid).append("<ul class='comment-reply-body'><li class='comment-body-li'><div class='comment-body'><div class='comment-reply-main'><span class='comment-content'>"+replace_em(C[k].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+C[k].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+C[k].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+C[k].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart' cid='"+C[k].comment.id+"' recid='"+C[k].comment.cid+"' id='ccid"+C[k].comment.id+"'>"+C[k].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div><img alt='' data-original='../images/nobody.png' class='comment-reply-headImg' src='../images/nobody.png'></div></li></ul>	")}}}}else{$(".commentlist").append("<li class='comment-body-li' id='cid"+G[i].comment.id+"'><div class='comment-body'><img alt='' class='comment-headImg'  src='../images/nobody.png'><div class='comment-main'><span class='comment-content'>"+replace_em(G[i].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+G[i].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+G[i].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+G[i].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart' cid='"+G[i].comment.id+"' recid='"+G[i].comment.cid+"' id='ccid"+G[i].comment.id+"'>"+G[i].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div>	</div></li>");for(k in C){if(C[k].comment.cid==G[i].comment.id){if(C[k].flag=="false"){$("#cid"+C[k].comment.cid).append("<ul class='comment-reply-body'><li class='comment-body-li'><div class='comment-body'><div class='comment-reply-main'><span class='comment-content'>"+replace_em(C[k].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+C[k].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+C[k].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+C[k].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+C[k].comment.id+"' recid='"+C[k].comment.cid+"' id='ccid"+C[k].comment.id+"'>"+C[k].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div><img alt='' data-original='../images/nobody.png' class='comment-reply-headImg' src='../images/nobody.png'></div></li></ul>	")}else{$("#cid"+C[k].comment.cid).append("<ul class='comment-reply-body'><li class='comment-body-li'><div class='comment-body'><div class='comment-reply-main'><span class='comment-content'>"+replace_em(C[k].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+C[k].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+C[k].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+C[k].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart' cid='"+C[k].comment.id+"' recid='"+C[k].comment.cid+"' id='ccid"+C[k].comment.id+"'>"+C[k].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div><img alt='' data-original='../images/nobody.png' class='comment-reply-headImg' src='../images/nobody.png'></div></li></ul>	")}}}}}if(E.pageNow>1){$("#page").append("<a href='javascript:void(0)' id='pa' class='btn btn-default' pagenow='"+(A-1)+"'><span class='fa'>上一页</span></a>")}if(E.begin>=2){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+1+"'>1</a>")}if(E.beginDot){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.2' id='pa'><span class='fa'>...</span></a>")}var D=E.betweenPageList;for(k in D){if(D[k]==A){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.8;background:#3399CC;' id='pa' pagenow='"+D[k]+"'><span style='color:#fff;'>"+D[k]+"</span></a>")}else{$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+D[k]+"'>"+D[k]+"</a>")}}if(E.endDot){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.2' id='pa'><span class='fa'>...</span></a>")}if(E.end<E.totalPageCount){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+E.totalPageCount+"'>"+E.totalPageCount+"</a>")}if(E.pageNow<E.totalPageCount){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+(A+1)+"'>下一页</a>")}$(".pageBody").append("<span class='totalCounts'>到第<input value='' class='btn btn-default' name='pn' id='pn_input' size='3' />页 <input id='pn_btn' type='button' class='btn btn-default' value='确定'>&nbsp; 共 <span id='totalPageCount'>"+E.totalPageCount+"</span> 页/"+E.totalCount+"个<span>");A=$("#pa").attr("pagenow")}else{for(i in G){if(G[i].flag=="false"){$(".commentlist").append("<li class='comment-body-li' id='cid"+G[i].comment.id+"'><div class='comment-body'><img alt='' class='comment-headImg'  src='../images/nobody.png'><div class='comment-main'><span class='comment-content'>"+replace_em(G[i].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+G[i].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+G[i].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+G[i].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart-empty' cid='"+G[i].comment.id+"' recid='"+G[i].comment.cid+"' id='ccid"+G[i].comment.id+"'>"+G[i].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div>	</div></li>")}else{$(".commentlist").append("<li class='comment-body-li' id='cid"+G[i].comment.id+"'><div class='comment-body'><img alt='' class='comment-headImg'  src='../images/nobody.png'><div class='comment-main'><span class='comment-content'>"+replace_em(G[i].comment.value)+"</span><div class='comment-meta'><span class='comment-author'><a href='javascript:void(0)'>"+G[i].comment.name+"</a></span><span class='comment-time'><i class='glyphicon glyphicon-calendar'>"+G[i].comment.time+"</i></span><span class='comment-ip'><i class='glyphicon glyphicon-pushpin'>"+G[i].comment.ip+"</i></span><span class='comment-goods'><i class='glyphicon glyphicon-heart' cid='"+G[i].comment.id+"' recid='"+G[i].comment.cid+"' id='ccid"+G[i].comment.id+"'>"+G[i].comment.praisenum+"</i></span><span class='comment-reply-link'>回复</span></div></div>	</div></li>")}}if(E.pageNow>1){$("#page").append("<a href='javascript:void(0)' id='pa' class='btn btn-default' pagenow='"+(A-1)+"'><span class='fa'>上一页</span></a>")}if(E.begin>=2){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+1+"'>1</a>")}if(E.beginDot){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.2' id='pa'><span class='fa'>...</span></a>")}var D=E.betweenPageList;for(k in D){if(D[k]==A){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.8;background:#3399CC;' id='pa' pagenow='"+D[k]+"'><span style='color:#fff;'>"+D[k]+"</span></a>")}else{$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+D[k]+"'>"+D[k]+"</a>")}}if(E.endDot){$("#page").append("<a href='javascript:return false;' class='btn btn-default disabled' style='opacity:0.2' id='pa'><span class='fa'>...</span></a>")}if(E.end<E.totalPageCount){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+E.totalPageCount+"'>"+E.totalPageCount+"</a>")}if(E.pageNow<E.totalPageCount){$("#page").append("<a href='javascript:void(0)' class='btn btn-default' id='pa' pagenow='"+(A+1)+"'>下一页</a>")}$(".pageBody").append("<span class='totalCounts'> 到第<input value='' class='btn btn-default' name='pn' id='pn_input' size='3' />页 <input id='pn_btn' type='button' class='btn btn-default' value='确定'>&nbsp; 共 <span id='totalPageCount'>"+E.totalPageCount+"</span> 页/"+E.totalCount+"个<span>");A=$("#pa").attr("pagenow")}}else{$(".commentlist").append("<div class='nothing'><div class='nothing_img'></div></div>")}}})}function letDivCenter(B,A){var E=($(window).height()-$(B).height())/2;var D=($(window).width()-$(B).width())/2;var C=$(document).scrollTop();var F=$(document).scrollLeft();$(B).css({position:"absolute",top:E+C,left:D+F}).show().children("b").html(A)};